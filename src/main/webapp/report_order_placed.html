<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Report Order Placed</title>
        <style>
            .tftable {
                font-size:14px;
                color:#333333;
                width:100%;
                border-width: 1px;
                border-color: #87ceeb;
                border-collapse: collapse;
            }
            .tftable th {
                font-size:18px;
                background-color:#87ceeb;
                border-width: 1px;
                padding: 8px;
                border-style: solid;
                border-color: #87ceeb;
                text-align:left;
            }
            .tftable tr {
                background-color:#ffffff;
            }
            .tftable td {
                font-size:14px;
                border-width: 1px;
                padding: 8px;
                border-style: solid;
                border-color: #87ceeb;
            }
            .tftable tr:hover {
                background-color:#e0ffff;
            }
        </style>
    </head>
    <body>
        <table id="dataTable" class="tftable" border="1">
            <tr>
                <th>Customer ID</th>
                <th>Date Placed</th>
                <th>Pickup Time</th>
                <th>Fulfilled</th>
                <th>Comment</th>
                <th>Amount</th>
                <th>Status</th>
                <th>ID</th>
            </tr>
        </table>

        <script>

            // Function to prompt the user to enter query parameters
            function promptQueryParams() {
                var startDate = prompt("Enter start date (YYYY-MM-DD):");
                var endDate = prompt("Enter end date (YYYY-MM-DD):");
                var sortOrder = prompt("Enter sort order:");

                // Confirm query parameters
                var confirmMsg = "Start Date: " + startDate + "\nEnd Date: " + endDate + "\nSort Order: " + sortOrder + "\n\nAre these correct?";
                var isConfirmed = confirm(confirmMsg);

                if (isConfirmed) {
                    fetchData(startDate, endDate, sortOrder);
                } else {
                    // Handle cancellation or incorrect input
                    console.log("User cancelled or provided incorrect input.");
                }
            }

            // Function to fetch data asynchronously with query parameters
            function fetchData(startDate, endDate, sortOrder) {
                var apiUrl = 'http://localhost:8080/BakerySystem/api/orders/orders_placed/';
                apiUrl += '?startDate=' + startDate + '&endDate=' + endDate + '&sortOrder=' + sortOrder;

                fetch(apiUrl)
                        .then(response => {
                            if (!response.ok) {
                                throw new Error('Network response was not ok');
                            }
                            return response.json();
                        })
                        .then(data => {
                            renderData(data);
                        })
                        .catch(error => {
                            console.error('Error fetching data:', error);
                            alert('Error fetching data. Please check console for details.');
                        });
            }



            // Function to render fetched data in the table
            function renderData(data) {
                var table = document.getElementById("dataTable");
                var value = 0;
                data.forEach(row => {
                    var tr = document.createElement("tr");
                    tr.innerHTML = `
            <td>${row.customerID}</td>
            <td>${formatDate(row.datePlaced)}</td>
            <td>${formatDate(row.pickupTime)}</td>
            <td>${row.fulfilled === 1 ? "Yes" : row.fulfilled === 0 ? "No" : ""}</td>
            <td>${row.comment}</td>
            <td>R${row.amount}</td>
            <td>${row.status}</td>
            <!-- Add more table cells if needed -->
        `;
                    table.appendChild(tr);
                });
            }
            // Function to format a date object into a string representation
            function formatDate(dateObj) {
                // Check if the input is a valid date object
                if (typeof dateObj === 'object' && dateObj.year && dateObj.monthValue && dateObj.dayOfMonth && dateObj.hour && dateObj.minute && dateObj.second) {
                    // Extract components of the date
                    var year = dateObj.year;
                    var month = ("0" + dateObj.monthValue).slice(-2); // Month is one-indexed in this format
                    var day = ("0" + dateObj.dayOfMonth).slice(-2);
                    var hour = ("0" + dateObj.hour).slice(-2);
                    var minute = ("0" + dateObj.minute).slice(-2);
                    var second = ("0" + dateObj.second).slice(-2);

                    // Construct the string representation of the date
                    return `${year}-${month}-${day} ${hour}:${minute}:${second}`;
//                    return `${year}`;

                } else {
                    // Return an empty string if the input is not in the expected format
                    return "";
                }
            }


            // Call promptQueryParams when the page loads
            window.onload = promptQueryParams;
        </script>
    </body>
</html>
